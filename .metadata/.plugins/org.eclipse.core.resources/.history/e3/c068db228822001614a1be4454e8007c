package com.automatic.controller.helpers;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Component;

import com.automatic.database.DatabaseConnector;


@Component
public class TimerService {

	DatabaseConnector connector;
	public void updateStudentRecord()
	{
		System.out.println("scheduler running...");
		
		String queryStatement = "SELECT * FROM finance";
		
		connector = new DatabaseConnector();
		try
		{
			PreparedStatement statement = connector.getConnection().prepareStatement(queryStatement);
			ResultSet set = statement.executeQuery();
			
			while(set.next())
			{
				String tuition = set.getString("tuition");
				String studentnumber = set.getString("studentnumber");
				System.out.println(studentnumber + "==="+tuition);
				
				do
				{
					break;
				}while(updateTuition(studentnumber, tuition) == 0);
				
			}
		} 
		catch (SQLException e)
		{
			System.out.println(e.getMessage());
			e.printStackTrace();
		}
	}
	
	private int updateTuition(String studentnumber, String amount)
	{
		connector = new DatabaseConnector();
		
		String chopChopMoneey = String.valueOf((Integer.valueOf(amount) - 10483));
		
		String updateTuition = "UPDATE finance SET tuition='"+chopChopMoneey+"' WHERE studentnumber='"+studentnumber+"'";
		
		try
		{
			PreparedStatement statement = connector.getConnection().prepareStatement(updateTuition);
			return statement.executeUpdate();
		}
		catch (SQLException e)
		{
			System.out.println(e.getMessage());
			return 0;
		}
	}
}
